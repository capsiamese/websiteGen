---
title: "光线投射"
date: 2023-02-13T19:18:01+08:00
draft: true
tags: []
---

# 简介

光线投射(Raycasting)是一种将3D远景渲染到2D地图的技术. 退回到计算机还很慢的时代, 实时运行一个真实的3D引擎是不可能的, 这时光线投射就成为了首选方案.

这项技术可以运行的非常快速, 因为只对垂直屏幕的每条线做计算.

而使用这项技术最知名的游戏就是德军总部3D(Wolfenstein 3D).

德军总部的光线投射引擎是非常有限的, 甚至可以在286电脑上运行. 所有的墙都具有相同的高度并且正交在一个方形的2D网格中.

像楼梯, 跳跃或者实现高度差使用这个引擎是不能实现的. 之后的游戏像Doom和毁灭公爵3D(Duke Nukem 3D)也使用光线投射技术但是是更先进的引擎, 可以实现
倾斜的墙, 高度差, 具有纹理的地板和天花板, 空气墙等... 贴图(Sprite)是2D图片这里不做介绍.

光线投射和光线追踪(raytracing)是不同的, 光线投射是一种快速的半3D(semi-3D)技术, 它甚至可以实时运行在4MHz的图形计算卡上. 
而光线追踪是一种模拟真实的光线的渲染技术, 它支持反射和阴影在真实的3D场景中, 并且只有现在的电脑能足够快速的运行它实现贴近现实的高解析度和复杂的场景.

# 基本想法

关于光线投射的基本想法是: 地图是一个2D方形的网格, 并且每个方格可以是0(= 没有墙)或者一个关联值(= 一堵有具体颜色的墙或纹理).

对于屏幕上的每个x(例如 屏幕上的每一个垂直条纹), 从玩家位置发出一条射线, 其方向取决于玩家的视线方向和屏幕x轴的坐标, 然后使该射线在2D地图上向前移动, 
直到碰到地图上的方块墙, 如果碰到了方块墙则计算击中点到玩家之间的距离, 然后使用这个距离计算需要绘制在屏幕上墙的高度, 离墙越远墙的高度越矮, 反之越高.
这就是所有的2D计算, 这张图片展示了一个俯视的两条红色射线从玩家击中墙.




## 参考
[Ray casting](https://lodev.org/cgtutor/index.html)